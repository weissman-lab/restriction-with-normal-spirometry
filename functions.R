get_diagnosis_percentage <- function (data, diagnosis, type, year) {
  
  numerator <- data %>% 
    filter (
      interpretation == type &
      .data[[paste (diagnosis, "diagnosis", year, sep = "_")]] == 1) %>% 
    nrow ()
  
  denominator <- data %>% 
    filter (
      interpretation == type &
      .data[[paste ("diagnosis_", year, sep = "")]]
    ) %>%
    nrow ()
    
  result <- list (
    (numerator / denominator) %>%
      multiply_by (100) %>% 
      round (digits = 1) %>% 
      format (nsmall = 1),
    exactci (numerator, denominator, 0.95)$conf.int [[1]] %>% 
      multiply_by (100) %>% 
      round (digits = 1) %>% 
      format (nsmall = 1),
    exactci (numerator, denominator, 0.95)$conf.int [[2]] %>% 
      multiply_by (100) %>% 
      round (digits = 1) %>% 
      format (nsmall = 1)
    )
  
  return (result)
  
}

get_mu <- function (age, height, sex, parameter) {
  
  if (parameter == "dlco") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.128515868, -0.135104462, -0.13407472, -0.125143061, -0.109243763,
        -0.087877995, -0.062733439, -0.035777023, -0.008681143, 0.017032276,
        0.04038244, 0.060840625, 0.078134575, 0.09233291, 0.103666313, 
        0.112363058, 0.118721468, 0.123039179, 0.125569296, 0.126558724,
        0.126253593, 0.124862604, 0.12256176, 0.119505705, 0.115830933,
        0.111653411, 0.107071744, 0.102169716, 0.097017703, 0.091675626,
        0.086194886, 0.080619623, 0.07498703, 0.069319555, 0.063630092,
        0.057929744, 0.052228194, 0.046533886000000003, 0.040853919,
        0.035186377, 0.029520372, 0.023845914, 0.018154319, 0.012438044,
        0.006690554, 0.000906207, -0.004918448, -0.010783421, -0.016688222,
        -0.022632281, -0.028614964, -0.034635582, -0.040693407, -0.046787673,
        -0.052916884, -0.059074541, -0.065252486, -0.071443254, -0.077640019,
        -0.083836543, -0.090027127, -0.096206557, -0.102370073, -0.108513326,
        -0.114632106, -0.120721615, -0.12677723, -0.132794735, -0.138770281,
        -0.144700363, -0.150581791, -0.156411664, -0.16218735, -0.167906461,
        -0.17356684, -0.179166608, -0.184705341, -0.190183769, -0.195602658,
        -0.200962771, -0.206264865, -0.211510015, -0.216698878, -0.221831778,
        -0.226909057
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-7.034920 + 2.018368 * log (height) - 0.012425 * log (age) + m_spline)
      
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.154014097, -0.130179828, -0.107947464, -0.08681274, -0.066790881,
        -0.048075978, -0.030872103, -0.015367019, -0.001606473, 0.01048621,
        0.021026682, 0.030164412, 0.038035475, 0.044748434, 0.050395479,
        0.055062304, 0.058835245, 0.061794022, 0.064009966, 0.065556999,
        0.066508379, 0.066927851, 0.066870938, 0.066386573, 0.065517922,
        0.064302996, 0.062775387, 0.060964708, 0.058896905, 0.056595112,
        0.05408007, 0.05137042, 0.048483358, 0.045436334, 0.042245606,
        0.038925778, 0.035489986, 0.031950076, 0.02831709, 0.024603483,
        0.020821509, 0.016982159, 0.013095294, 0.009169768, 0.005213539,
        0.001233829, -0.002762129, -0.006767371, -0.010775638, -0.014781307,
        -0.018779328, -0.022765169, -0.026734761, -0.030684461, -0.034611264,
        -0.03851285, -0.042387176, -0.046232425, -0.05004698, -0.05382941,
        -0.057578449, -0.061292985, -0.064972041, -0.068614782, -0.072220663,
        -0.075789335, -0.079320519, -0.082814001, -0.086269622, -0.089687275,
        -0.093066901, -0.096408483, -0.09971204, -0.10297763, -0.106205344,
        -0.109395541, -0.112548886, -0.11566605, -0.118747686, -0.121794431,
        -0.124806908, -0.127785725, -0.130731473, -0.133644726, -0.136526054
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-5.159451 + 1.618697 * log (height) - 0.015390 * log (age) + m_spline)      
      
    }
    
  }
  
  if (parameter == "fev1") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.076629683, -0.074514202, -0.074823324, -0.075695829, -0.072537805,  
        -0.061753529, -0.041712276, -0.01460646, 0.016886095, 0.049149418,
        0.078696905, 0.10346408, 0.123005703, 0.137322301, 0.146600993,
        0.151708117, 0.153621752, 0.153121563, 0.150830316, 0.147244378,
        0.142763215, 0.137710088, 0.132345912, 0.126834828, 0.121249596,
        0.11564601, 0.110070059, 0.104559617, 0.099136143, 0.093764967,
        0.088399368, 0.083000059, 0.077534064, 0.07197376, 0.06629601,
        0.060476196, 0.054484844, 0.048296381, 0.04188945, 0.035246319,
        0.028352392, 0.021195775, 0.01376715, 0.006068828, -0.001883729,
        -0.010075221, -0.018491388, -0.027118923, -0.035945394, -0.044959178,
        -0.054149393, -0.063505845, -0.073016305, -0.082655565, -0.092396128,
        -0.102212913, -0.112083045, -0.121985652, -0.131901696, -0.141813804,
        -0.151706132, -0.161564228, -0.171374918, -0.181126344, -0.190810569,
        -0.200422931, -0.209959313, -0.219416006, -0.228789679, -0.238077342,
        -0.247276324, -0.256384243, -0.265398986, -0.274318682, -0.283141688,
        -0.291866568, -0.300492075, -0.309017518, -0.317444317, -0.325774525,
        -0.334010132, -0.342153068, -0.350205204, -0.358168358, -0.366044293,
        -0.373834721, -0.381541304, -0.389165781, -0.396709555, -0.40417391
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-11.399108 + 2.462664 * log (height) - 0.011394 * log (age) + m_spline)
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.138890127, -0.123387223, -0.106500168, -0.0867585, -0.063702899,
        -0.038030844, -0.011173899, 0.014961115, 0.039091821, 0.060315153,
        0.078122708, 0.092535584, 0.103844979, 0.112327738, 0.118398662,
        0.122576169, 0.125281242, 0.126849083, 0.127538078, 0.12755072,
        0.127051801, 0.126175989, 0.125010063, 0.123561972, 0.121829639,
        0.119813578, 0.117516272, 0.114940426, 0.112074018, 0.108897938,
        0.105397742, 0.10156304, 0.097386774, 0.092864634, 0.087995951,
        0.082786527, 0.077243858, 0.071375788, 0.065190389, 0.058695875,
        0.051900526, 0.044812637, 0.037444612, 0.029820512, 0.021964617, 
        0.013899103, 0.005644251, -0.002781368, -0.011360738, -0.020078246,
        -0.028919554, -0.037871298, -0.046917484, -0.056040141, -0.065222747,
        -0.074450222, -0.083708798, -0.0929859, -0.102270048, -0.111550754, 
        -0.120818444, -0.130064373, -0.139280562, -0.148459734, -0.157595268,
        -0.166681133, -0.175711838, -0.184682384, -0.193588228, -0.202425244,
        -0.211189692, -0.219878185, -0.228487664, -0.237015369, -0.245458821,
        -0.253815793, -0.262084298, -0.270263347, -0.278353995, -0.286357579,
        -0.294275416, -0.302108801, -0.309859007, -0.317527283, -0.325114858,
        -0.33262294, -0.340052714, -0.347405345, -0.354681976, -0.361883731
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-10.901689 + 2.385928 * log (height) - 0.076386 * log (age) + m_spline)
      
    }        
    
  }
  
  if (parameter == "fvc") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.040465397, -0.042835353, -0.046580545, -0.04979453, -0.050163799,
        -0.046113283, -0.036958928, -0.02339395, -0.006386638, 0.012358413, 
        0.031070313, 0.048548818, 0.063991603, 0.076873763, 0.086919473,
        0.094355241, 0.099549029, 0.102808364, 0.104413805, 0.104692301, 
        0.103936201, 0.102385718, 0.100238459, 0.097639652, 0.094686887, 
        0.091460691, 0.088029015, 0.084449302, 0.080763297, 0.076969355, 
        0.073054326, 0.069007839, 0.064821851, 0.060490255, 0.056008528, 
        0.05137049, 0.046566513, 0.041588509, 0.036430171, 0.031086714, 
        0.025554642, 0.019831568, 0.013916223, 0.007815566, 0.001546046,
        -0.004876606, -0.011437984, -0.018124886, -0.024925196, -0.031827787,
        -0.038822425, -0.045899697, -0.053049639, -0.060256395, -0.067503357,
        -0.074775414, -0.082058811, -0.089341034, -0.096610696, -0.103857437, 
        -0.111071836, -0.118245329, -0.125370135, -0.132439298, -0.139448577,
        -0.146395987, -0.153279838, -0.160098642, -0.166851098, -0.173536074,
        -0.180152592, -0.186699817, -0.193177044, -0.199583686, -0.205919265,
        -0.212183402, -0.21837581, -0.224496486, -0.230546559, -0.236527485,
        -0.242440679, -0.248287512, -0.254069314, -0.259787376, -0.265442953,
        -0.271037262, -0.276571486, -0.282046886, -0.287464428, -0.292824984
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-12.629131 + 2.727421 * log (height) + 0.009174 * log (age) + m_spline)
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.088232796, -0.078846087, -0.069656094, -0.059555991, -0.048029429,
        -0.035157502, -0.021361643, -0.007268505, 0.00661104, 0.019773006, 
        0.031886451, 0.042790016, 0.05242463, 0.060776064, 0.067920702,
        0.074001808, 0.07914435, 0.083454792, 0.087025974, 0.089938741, 
        0.092262928, 0.094059159, 0.095370919, 0.096211588, 0.0965914,
        0.096522124, 0.096016555, 0.095087507, 0.093740296, 0.091976457,
        0.089799516, 0.087214661, 0.084228359, 0.080848058, 0.077084193,
        0.072955247, 0.068480368, 0.063677496, 0.058563454, 0.053154032,
        0.047464061, 0.041507489, 0.035301158, 0.028871645, 0.022245107,
        0.015445279, 0.008493719, 0.001410025, -0.00578797, -0.013084028,
        -0.020463354, -0.02791235, -0.035416563, -0.042960981, -0.050531888,
        -0.058116805, -0.065704385, -0.073284305, -0.080847178, -0.088384471,
        -0.095888429, -0.103352005, -0.110768804, -0.118133438, -0.125442549,
        -0.132693467, -0.139883802, -0.147011417, -0.15407441, -0.161071094,
        -0.167999977, -0.174859746, -0.181649256, -0.18836751, -0.195013653,
        -0.201586955, -0.208086806, -0.214513177, -0.220867259, -0.227150393,
        -0.233363887, -0.239509012, -0.245587009, -0.251599087, -0.257546423,
        -0.263430165, -0.269251433, -0.275011318, -0.280710886, -0.286351175
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-12.055901 + 2.621579 * log (height) - 0.035975 * log (age) + m_spline)
      
    }
    
  }
  
  if (parameter == "fev1/fvc") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.032117366, -0.031175746, -0.028435729, -0.024978945, -0.020173925, 
        -0.012645459, -0.00269177, 0.008311922, 0.018847292, 0.027821511,
        0.034654166, 0.039270883, 0.041939718, 0.043033726, 0.042939412, 
        0.041976643, 0.040417461, 0.038471711, 0.036290841, 0.033981428,
        0.031620531, 0.029262244, 0.026942503, 0.0246844, 0.022501808,
        0.020400952, 0.018377747, 0.016418939, 0.014508933, 0.012630404, 
        0.010775431, 0.008942585, 0.007133684, 0.005349458, 0.003591451,
        0.001860799, 0.000159386, -0.001511981, -0.003151699, -0.004759005,
        -0.006334722, -0.007883047, -0.00940954, -0.010917616, -0.012407048,
        -0.013877272, -0.015329917, -0.016766695, -0.018188443, -0.019594596,
        -0.020984153, -0.022356371, -0.023710902, -0.025047792, -0.026367909,
        -0.027671649, -0.028959947, -0.030233855, -0.031494384, -0.032431297,
        -0.033977614, -0.035201913, -0.036415157, -0.037616377, -0.03880421,
        -0.03997743, -0.04113479, -0.04227549, -0.043399198, -0.044505761,
        -0.045595232, -0.046667758, -0.047985281, -0.048763867, -0.049788563,
        -0.050798558, -0.051794487, -0.052776879, -0.053746213, -0.054702992,
        -0.05564775, -0.056580978, -0.057503132, -0.058414597, -0.059315692
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (1.022608 - 0.218592 * log (height) - 0.027586 * log (age) + m_spline)
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.044784354, -0.040463834, -0.03366171, -0.025586344, -0.01629574, 
        -0.005527463, 0.00580655, 0.016396842, 0.025252761, 0.031991009,
        0.036681939, 0.039611046, 0.041121214, 0.041523375, 0.041067832, 
        0.039979943, 0.038451661, 0.036636994, 0.034650922, 0.032567993,
        0.030436775, 0.028293127, 0.026159498, 0.024042924, 0.021945143, 
        0.019866836, 0.017808159, 0.015769248, 0.01375205, 0.01175805, 
        0.009795055, 0.007873685, 0.006004177, 0.004197303, 0.002464665,
        0.000816928, -0.000738675, -0.002199378, -0.00356516, -0.004838988,
        -0.006024997, -0.007129056, -0.008157648, -0.00911827, -0.010019727,
        -0.01087146, -0.011682432, -0.012459748, -0.013208761, -0.01393335,
        -0.014636918, -0.01532301, -0.015995898, -0.016659657, -0.01731823,
        -0.017975858, -0.018635432, -0.019298747, -0.019965877, -0.020635719, 
        -0.021307311, -0.021979595, -0.022651077, -0.023319829, -0.023984162,
        -0.024643034, -0.025295621, -0.025941356, -0.026579634, -0.027209901,
        -0.02783161, -0.028444489, -0.02904843, -0.029643611, -0.030230349,
        -0.030809071, -0.031380217, -0.031944124, -0.032501094, -0.033051396,
        -0.033595289, -0.034132946, -0.034664545, -0.035190276, -0.035710262
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (0.9189568 - 0.1840671 * log (height) - 0.0461306 * log (age) + m_spline)
      
    }
    
  }
  
  if (parameter == "kco") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.111539532, -0.102096995, -0.091000995, -0.077797767, -0.062773978,
        -0.046547511, -0.029844057, -0.013533233, 0.001737096, 0.015499183,
        0.027491821, 0.037617583, 0.045864622, 0.052364616, 0.057308926,
        0.060868707, 0.063232136, 0.064575797, 0.065047442, 0.064787554,
        0.063933168, 0.062599201, 0.060881286, 0.05885793, 0.056593659,
        0.054142762, 0.051551076, 0.0488571, 0.046092216, 0.043282723,
        0.040450973, 0.03761597, 0.034793259, 0.03198819, 0.029199931,
        0.026427629, 0.023670526, 0.020927945, 0.018199164, 0.015479992,
        0.012762726, 0.010040424, 0.007307035, 0.004557292, 0.001786615,
        -0.001008958, -0.003831392, -0.00667933, -0.009551107, -0.012445162,
        -0.015360029, -0.018294334, -0.021246784, -0.024216162, -0.027200976,
        -0.030197326, -0.03320056, -0.036206433, -0.039211073, -0.042210953,
        -0.045202855, -0.04818385, -0.051151269, -0.054102684, -0.057035891,
        -0.059948921, -0.06283999, -0.065707483, -0.068549935, -0.071366024,
        -0.074154553, -0.076914446, -0.079644737, -0.082344557, -0.085013133,
        -0.087649811, -0.090254683, -0.092828428, -0.095371721, -0.097885218,
        -0.100369553, -0.102825316, -0.105253108, -0.107653538, -0.110027191
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (4.088408 - 0.415334 * log (height) - 0.113166 * log (age) + m_spline)      
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.041680482, -0.033827953, -0.02650855, -0.019747865, -0.013719944,
        -0.008522835, -0.004165779, -0.000589833, 0.002330125, 0.004785295,
        0.006913375, 0.008796447, 0.010487308, 0.011971881, 0.013215825,
        0.014199907, 0.014925701, 0.015401941, 0.01563926, 0.015663317,
        0.015508438, 0.015203788, 0.014774173, 0.0142433, 0.01363275,
        0.012960709, 0.012242517, 0.011490825, 0.010715628, 0.009925312,
        0.00912701, 0.008326787, 0.007529779, 0.006740242, 0.005961751,
        0.00519734, 0.004449571, 0.003720605, 0.003012244, 0.002325932,
        0.001662833, 0.001023897, 0.00040989, -0.000178581, -0.000741052,
        -0.001277329, -0.001789042, -0.002278778, -0.00274891, -0.003201602,
        -0.003638824, -0.004062377, -0.004473904, -0.004874908, -0.005266864,
        -0.005651263, -0.006029476, -0.006402755, -0.006772244, -0.007138988,
        -0.007503942, -0.007867977, -0.008231889, -0.008596348, -0.008961335,
        -0.009326446, -0.009691305, -0.010055564, -0.010418905, -0.010781034,
        -0.01114168, -0.011500595, -0.01185755, -0.012212336, -0.01256476,
        -0.012914669, -0.013261954, -0.013606518, -0.013948269, -0.014287129,
        -0.014623024, -0.01495589, -0.015285667, -0.015612299, -0.015935744
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (5.131492 - 0.645656 * log (height) - 0.097395 * log (age) + m_spline)   
      
    }
    
  }
  
  if (parameter == "rv") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        0.141503886, 0.142080573, 0.14263204, 0.143145413, 0.143603968,
        0.143964597, 0.144172964, 0.144174696, 0.143912152, 0.143302497,
        0.142251163, 0.14066352, 0.138449435, 0.13555735, 0.131955331,
        0.127611596, 0.122500264, 0.116651811, 0.110128008, 0.102990959,
        0.095304765, 0.087154832, 0.07863947, 0.069857169, 0.060906783,
        0.051891552, 0.042917611, 0.034091143, 0.025519319, 0.017322626,
        0.009631119, 0.002575066, -0.003716815, -0.009139476, -0.013606378,
        -0.017031474, -0.019332893, -0.020501678, -0.020590881, -0.019655527,
        -0.017753929, -0.015010324, -0.01160991, -0.007740177, -0.003586416,
        0.000717217, 0.005087966, 0.009445336, 0.013709101, 0.017806411,
        0.021672476, 0.025242917, 0.028453865, 0.031257869, 0.033626995,
        0.035534445, 0.036953993, 0.037881343, 0.038340562, 0.038357598,
        0.037958235, 0.037160564, 0.035971846, 0.034398533, 0.032447232,
        0.030133903, 0.027488826, 0.024543497, 0.02132941, 0.017878056,
        0.014220927, 0.010389511, 0.006415259, 0.002325896, -0.001857643
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-2.37211 + 0.01307 * height + 0.01346 * age + m_spline)
      
    } else {
      
      m_spline_lookup_table <- c (
        0.048916273, 0.049719193, 0.050503374, 0.051262262, 0.05198378,
        0.052650233, 0.053243674, 0.053746152, 0.054136015, 0.054380804,
        0.054446101, 0.05429749, 0.053901289, 0.053230947, 0.052263906,
        0.050977652, 0.04934996, 0.047376185, 0.045079015, 0.042483502,
        0.039614696, 0.036501549, 0.033191421, 0.029737096, 0.026191357,
        0.022607519, 0.019048358, 0.015584776, 0.01228794, 0.009229008,
        0.006476913, 0.004095194, 0.00214659, 0.000693838, -0.000206851,
        -0.00055007, -0.000354223, 0.000362154, 0.001579652, 0.003244489,
        0.005257878, 0.007517988, 0.009922988, 0.012371772, 0.014766048,
        0.017008206, 0.019000639, 0.020650775, 0.021934979, 0.022879563,
        0.023511954, 0.02385963, 0.023957108, 0.02385311, 0.023598071,
        0.023242423, 0.022828255, 0.022344819, 0.021760752, 0.021044647,
        0.020166015, 0.019119928, 0.017929682, 0.016620032, 0.015215733,
        0.013738441, 0.012199908, 0.010609907, 0.008978212, 0.007313275,
        0.005609308, 0.00385184, 0.002026281, 0.000118181, -0.001875766
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (-2.50593 + 0.01379 * height + 0.01307 * age + m_spline)      
      
    }
    
  }
  
  if (parameter == "tlc") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.084004394, -0.077960516, -0.071891043, -0.064588939, -0.055253542,
        -0.043587273, -0.029831587, -0.014709166, 0.000810758, 0.015785361,
        0.029433479, 0.041345825, 0.051346709, 0.059402186, 0.065638854,
        0.07019625, 0.073248057, 0.075002814, 0.075639347, 0.075323655,
        0.074229373, 0.072505502, 0.07027641, 0.067651297, 0.064726805,
        0.061584094, 0.058291245, 0.054906123, 0.051478833, 0.048051669,
        0.044660156, 0.041334056, 0.038092762, 0.034942205, 0.031885982,
        0.028926824, 0.026066728, 0.023306502, 0.020635958, 0.018036808,
        0.015492571, 0.012988674, 0.010512224, 0.008051817, 0.005596783,
        0.003135006, 0.000655001, -0.001853377, -0.004399081, -0.006990001,
        -0.009633081, -0.012334363, -0.015095595, -0.017912606, -0.020781005,
        -0.023696719, -0.026655957, -0.029655197, -0.03269116, -0.035760789,
        -0.038861137, -0.041987218, -0.045132265, -0.04828996, -0.051454492,
        -0.054620514, -0.057783109, -0.060937754, -0.064080289, -0.06720689,
        -0.070314055, -0.073399205, -0.076460982, -0.079498238, -0.082509929
      )
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (
        -10.5861 +
          0.1433 * log (age) +
          2.3155 * log (height) + 
          m_spline
      )      
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.142986411, -0.119293793, -0.098957527, -0.081042267, -0.064516286,
        -0.048601064, -0.033160129, -0.018372153, -0.004709956, 0.007526767,
        0.018221651, 0.027348949, 0.0350004, 0.041306895, 0.046398371, 
        0.050446188, 0.05360938, 0.056019383, 0.057786724, 0.059004667,
        0.059751654, 0.060093439, 0.060081409, 0.059757591, 0.059158399,
        0.058315508, 0.057254369, 0.055993037, 0.054547241, 0.05293121,
        0.051157852, 0.049238768, 0.047183842, 0.045001942, 0.042701244,
        0.040289299, 0.037773093, 0.035158688, 0.032447289, 0.029637619,
        0.026728884, 0.023720742, 0.020613229, 0.017406699, 0.014101822,
        0.010701668, 0.007212254, 0.003639404, -1.15E-05, -0.003735307,
        -0.007527423, -0.011383424, -0.015299215, -0.019270414, -0.023288842,
        -0.027345163, -0.031430832, -0.035538037, -0.039659628, -0.04378907,
        -0.047920383, -0.052048096, -0.056167207, -0.060273167, -0.064362048,
        -0.068430383, -0.072475005, -0.076493028, -0.080481817, -0.084438976,
        -0.088362322, -0.092249873, -0.096099829, -0.099910561, -0.103680596
      )      
      
      m_spline <- m_spline_lookup_table [age - 5]
      
      mu <- exp (
        -10.1128 +
          0.1062 * log (age) +
          2.2259 * log (height) +
          m_spline
      ) 
      
    }
    
  }
    
  if (parameter == "va") {
      
    if (sex == 1) {
        
      m_spline_lookup_table <- c (
        -0.014055533, -0.031175397, -0.042024211, -0.046908818, -0.046653327,
        -0.042201141, -0.034485819, -0.024518431, -0.013265685, -0.00175995,
        0.009284414, 0.019425408, 0.028391029, 0.036111194, 0.042620437,
        0.04796965, 0.052254218, 0.055578958, 0.058035923, 0.059716618,
        0.060713275, 0.061105938, 0.060964053, 0.06035568, 0.059346966,
        0.057995034, 0.056349103, 0.054452675, 0.052347758, 0.050071875,
        0.047657479, 0.045132682, 0.042521735, 0.039843894, 0.037114704,
        0.034347729, 0.031554835, 0.02874641, 0.025931379, 0.023112273,
        0.020285328, 0.017446969, 0.01459412, 0.011724143, 0.008834786,
        0.005924129, 0.002990525, 3.25e-05, -0.00295104, -0.005961206,
        -0.008998774, -0.012064399, -0.015158591, -0.018281735, -0.021433723,
        -0.024611635, -0.027811572, -0.03102994, -0.034263433, -0.037509006,
        -0.040763857, -0.044025404, -0.047291269, -0.05055926, -0.053827023,
        -0.057091042, -0.060347746, -0.063593856, -0.06682636, -0.070042492,
        -0.073239715, -0.076415703, -0.079568322, -0.08269562, -0.08579581,
        -0.088867301, -0.091909355, -0.094921923, -0.097905004, -0.100858619,
        -0.103782815, -0.106678049, -0.109544301, -0.112381158, -0.11518826
      )
        
      m_spline <- m_spline_lookup_table [age - 5]
        
      mu <- exp (-11.086573 + 2.430021 * log (height) + 0.097047 * log (age) + m_spline)      
        
    } else {
        
      m_spline_lookup_table <- c (
        -0.114477519, -0.103498731, -0.091261602, -0.077384622, -0.062076668,
        -0.045988396, -0.02988864, -0.014568276, -0.000612094, 0.011536879,
        0.021706656, 0.030001786, 0.036576186, 0.041727982, 0.045775291,
        0.048964519, 0.051469135, 0.053421325, 0.054927239, 0.056052532,
        0.056834971, 0.057307071, 0.057496658, 0.057419867, 0.057086839,
        0.056507681, 0.055692417, 0.054650433, 0.053389884, 0.051918739,
        0.050244874, 0.048376025, 0.046319866, 0.044084424, 0.041677572,
        0.03910683, 0.036379369, 0.033502029, 0.030481576, 0.027326201,
        0.02404431, 0.020643703, 0.017131629, 0.013514831, 0.009799587,
        0.005992233, 0.002104072, -0.001851236, -0.005861277, -0.009914811,
        -0.014001656, -0.018112589, -0.02223925, -0.026374061, -0.030510217,
        -0.034641634, -0.038762806, -0.042868742, -0.046954924, -0.051017259,
        -0.055052047, -0.059055943, -0.063025926, -0.066959357, -0.070854753,
        -0.074711344, -0.078528475, -0.082305583, -0.086042195, -0.089737916,
        -0.093392423, -0.097005459, -0.100576828, -0.104106387, -0.107594053,
        -0.111040164, -0.114445547, -0.117811038, -0.121137447, -0.12442556,
        -0.127676141, -0.130889933, -0.134067656, -0.137210004, -0.140317665
      )
        
      m_spline <- m_spline_lookup_table [age - 5]
        
      mu <- exp (-9.873970 + 2.182316 * log (height) + 0.082868 * log (age) + m_spline)   
        
    }
      
  }
  
  return (mu)
  
}

get_mu_2012 <- function (age, height, sex, race, parameter) {
  
  if (parameter == "fev1") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.1133, -0.0893, -0.0752, -0.0787, -0.0822, -0.0778, -0.0691, -0.0549,
        -0.0395, -0.0176, 0.0169, 0.0612, 0.1068, 0.146, 0.1744, 0.1924, 0.2029,
        0.2081, 0.2091, 0.2071, 0.203, 0.197, 0.1899, 0.1821, 0.1739, 0.1656,
        0.1574, 0.1495, 0.1417, 0.134, 0.1265, 0.119, 0.1116, 0.104, 0.0962,
        0.0883, 0.0803, 0.0721, 0.0638, 0.0554, 0.0469, 0.0386, 0.0302, 0.0219,
        0.0135, 0.005, -0.0036, -0.0125, -0.0216, -0.0309, -0.0404, -0.0502,
        -0.0603, -0.0706, -0.0812, -0.092, -0.103, -0.1143, -0.1257, -0.1373,
        -0.149, -0.1608, -0.1727, -0.1846, -0.1966, -0.2086, -0.2207, -0.2328,
        -0.2449, -0.2569, -0.269, -0.281, -0.2929, -0.3048, -0.3166, -0.3282,
        -0.3398, -0.3512, -0.3625, -0.3737, -0.3848, -0.3957, -0.4065, -0.4172,
        -0.4277, -0.4381, -0.4484, -0.4586, -0.4687, -0.4787, -0.4885, -0.4983,
        -0.5079
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- -0.0708
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.1589
      #if (race == 3) race_correction <- -0.0351
      #if (race == 4) race_correction <- -0.0881
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0708
        
      mu <- exp (-10.342 + 2.2196 * log (height) + 0.0574 * log (age) + race_correction + m_spline)
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.2311, -0.1817, -0.1548, -0.1452, -0.131, -0.1125, -0.0897, -0.0573,
        -0.0172, 0.0274, 0.0709, 0.1086, 0.1379, 0.1583, 0.1711, 0.1785, 0.1823,
        0.1839, 0.1841, 0.1832, 0.1812, 0.1785, 0.1753, 0.1721, 0.169, 0.1658,
        0.1625, 0.159, 0.1553, 0.1512, 0.1467, 0.1418, 0.1365, 0.1308, 0.1246,
        0.118, 0.1112, 0.104, 0.0966, 0.0889, 0.0811, 0.0731, 0.065, 0.0568,
        0.0486, 0.0403, 0.0318, 0.0232, 0.0144, 0.0054, -0.0037, -0.0131,
        -0.0227, -0.0326, -0.0426, -0.0529, -0.0634, -0.0741, -0.085, -0.0961,
        -0.1075, -0.119, -0.1308, -0.1428, -0.155, -0.1674, -0.1799, -0.1926,
        -0.2055, -0.2184, -0.2315, -0.2445, -0.2576, -0.2707, -0.2838, -0.2968,
        -0.3098, -0.3226, -0.3354, -0.348, -0.3606, -0.373, -0.3852, -0.3974,
        -0.4094, -0.4213, -0.433, -0.4446, -0.4561, -0.4675, -0.4788, -0.4899,
        -0.5009
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- -0.0708
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.1484
      #if (race == 3) race_correction <- -0.0149
      #if (race == 4) race_correction <- -0.1208
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0708
        
      mu <- exp (-9.6987 + 2.1211 * log (height) - 0.0270 * log (age) + race_correction + m_spline)    
      
    }
    
  }
  
  if (parameter == "fvc") {
    
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.0938, -0.0731, -0.0589, -0.0591, -0.0632, -0.0622, -0.0547, -0.0418,
        -0.0308, -0.0178, 0.0038, 0.0346, 0.0693, 0.102, 0.1287, 0.1478, 0.1603,
        0.1672, 0.1697, 0.1692, 0.1665, 0.1623, 0.1571, 0.1513, 0.1451, 0.1387,
        0.1323, 0.1259, 0.1195, 0.113, 0.1067, 0.1006, 0.0945, 0.0885, 0.0826,
        0.0765, 0.0704, 0.0641, 0.0577, 0.051, 0.0443, 0.0374, 0.0304, 0.0233,
        0.016, 0.0086, 0.0011, -0.0066, -0.0145, -0.0226, -0.0308, -0.0393,
        -0.0479, -0.0567, -0.0658, -0.075, -0.0845, -0.0942, -0.1041, -0.1141,
        -0.1242, -0.1344, -0.1447, -0.1549, -0.1652, -0.1754, -0.1857, -0.1959,
        -0.2061, -0.2163, -0.2264, -0.2365, -0.2465, -0.2565, -0.2664, -0.2762,
        -0.2859, -0.2956, -0.3051, -0.3146, -0.3239, -0.3331, -0.3423, -0.3513,
        -0.3602, -0.3691, -0.3778, -0.3864, -0.395, -0.4034, -0.4118, -0.4201,
        -0.4283
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- -0.0825
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.1684
      #if (race == 3) race_correction <- -0.0405
      #if (race == 4) race_correction <- -0.1177
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0825
        
      mu <- exp (-11.2281 + 2.4135 * log (height) + 0.0865 * log (age) + race_correction + m_spline)  
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.194, -0.153, -0.1276, -0.1153, -0.1045, -0.0918, -0.0731, -0.0461,
        -0.0154, 0.0166, 0.0473, 0.0749, 0.0977, 0.1151, 0.1273, 0.1355, 0.1406,
        0.1436, 0.1453, 0.146, 0.1459, 0.1449, 0.1436, 0.1422, 0.1408, 0.1392,
        0.1374, 0.1355, 0.1333, 0.1309, 0.128, 0.1248, 0.1212, 0.1172, 0.1129,
        0.1082, 0.1031, 0.0977, 0.0919, 0.0858, 0.0794, 0.0727, 0.0658, 0.0587,
        0.0514, 0.0439, 0.0362, 0.0283, 0.0202, 0.0119, 0.0034, -0.0053, -0.0143,
        -0.0234, -0.0328, -0.0424, -0.0523, -0.0623, -0.0726, -0.083, -0.0936,
        -0.1043, -0.1152, -0.1263, -0.1375, -0.1488, -0.1603, -0.1718, -0.1835,
        -0.1952, -0.2069, -0.2187, -0.2305, -0.2422, -0.254, -0.2656, -0.2772,
        -0.2887, -0.3001, -0.3114, -0.3226, -0.3337, -0.3447, -0.3555, -0.3662,
        -0.3768, -0.3872, -0.3976, -0.4079, -0.418, -0.428, -0.4379, -0.4477
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- -0.0833
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.1555
      #if (race == 3) race_correction <- -0.0262
      #if (race == 4) race_correction <- -0.1516
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0833
        
      mu <- exp (-10.4030 + 2.2633 * log (height) + 0.0234 * log (age) + race_correction + m_spline)        
      
    }   
    
  }
  
  if (parameter == "fev1/fvc") {
  
    if (sex == 1) {
      
      m_spline_lookup_table <- c (
        -0.0221, -0.0132, -0.0125, -0.0167, -0.0169, -0.014, -0.0135, -0.0143,
        -0.0108, -0.0021, 0.0095, 0.0215, 0.0315, 0.0385, 0.0421, 0.0432, 0.0427,
        0.0414, 0.0397, 0.0377, 0.0357, 0.0335, 0.0314, 0.0292, 0.0271, 0.0252,
        0.0234, 0.0217, 0.0202, 0.0189, 0.0176, 0.0163, 0.0149, 0.0135, 0.012,
        0.0105, 0.0089, 0.0074, 0.0059, 0.0045, 0.0031, 0.0018, 5e-04, -6e-04,
        -0.0018, -0.0029, -0.0041, -0.0053, -0.0066, -0.0079, -0.0092, -0.0106,
        -0.012, -0.0134, -0.0149, -0.0163, -0.0178, -0.0192, -0.0206, -0.022,
        -0.0234, -0.0248, -0.0262, -0.0276, -0.029, -0.0304, -0.0318, -0.0332,
        -0.0346, -0.0359, -0.0373, -0.0386, -0.0399, -0.0411, -0.0424, -0.0436,
        -0.0448, -0.0459, -0.0471, -0.0482, -0.0493, -0.0504, -0.0515, -0.0526,
        -0.0536, -0.0547, -0.0557, -0.0567, -0.0577, -0.0587, -0.0597, -0.0606,
        -0.0616
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- 0.0106
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.0079
      #if (race == 3) race_correction <- 0.0055
      #if (race == 4) race_correction <- 0.0283
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- 0.0106
        
      mu <- exp (0.7403 + -0.1595 * log (height) + -0.0366 * log (age) + race_correction + m_spline)  
      
    } else {
      
      m_spline_lookup_table <- c (
        -0.0443, -0.0286, -0.0233, -0.0259, -0.0243, -0.0185, -0.0145, -0.0106,
        -0.0029, 0.008, 0.0194, 0.0289, 0.0355, 0.0393, 0.0409, 0.0411, 0.0403,
        0.0389, 0.037, 0.035, 0.0329, 0.0309, 0.0289, 0.027, 0.0253, 0.0237,
        0.0223, 0.0208, 0.0194, 0.018, 0.0165, 0.0149, 0.0133, 0.0116, 0.0099,
        0.0082, 0.0065, 0.0049, 0.0034, 0.002, 7e-04, -5e-04, -0.0015, -0.0024,
        -0.0032, -0.004, -0.0046, -0.0052, -0.0058, -0.0063, -0.0068, -0.0073,
        -0.0078, -0.0083, -0.0088, -0.0093, -0.0098, -0.0103, -0.0109, -0.0115,
        -0.0121, -0.0128, -0.0135, -0.0142, -0.015, -0.0157, -0.0165, -0.0173,
        -0.0181, -0.0188, -0.0196, -0.0204, -0.0211, -0.0218, -0.0226, -0.0233,
        -0.024, -0.0246, -0.0253, -0.0259, -0.0266, -0.0272, -0.0278, -0.0284,
        -0.0291, -0.0297, -0.0303, -0.0308, -0.0314, -0.032, -0.0326, -0.0331,
        -0.0337
      )
      
      m_spline <- m_spline_lookup_table [age - 2]
      
      race_correction <- 0.0106
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.0055
      #if (race == 3) race_correction <- 0.0088
      #if (race == 4) race_correction <- 0.0285
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- 0.0106
        
      mu <- exp (0.5506 - 0.1078 * log (height) - 0.0544 * log (age) + race_correction + m_spline)        
      
    }        
    
  }

  return (mu)
  
}

get_nu <- function (age, height, sex, parameter) {
  
  if (parameter == "dlco") {
    
    if (sex == 1) {
      
      nu <- 0.39482
      
    } else {
      
      nu <- 0.24160
      
    }
    
  }
  
  if (parameter == "fev1") {
    
    if (sex == 1) {
      
      nu <- 1.22703
      
    } else {
      
      nu <- 1.21388      
      
    }        
    
  }
  
  if (parameter == "fvc") {
    
    if (sex == 1) {
      
      nu <- 0.9346
      
    } else {
      
      nu <- 0.899
      
    }
    
  }
  
  if (parameter == "fev1/fvc") {
    
    if (sex == 1) {
      
      nu <- 3.8243 - 0.3328 * log (age)
      
    } else {
      
      nu <- 6.6490  - 0.9920 * log (age)
      
    }
    
  }
  
  if (parameter == "kco") {
    
    if (sex == 1) {
      
      nu <- 0.67330
      
    } else {
      
      nu <- 0.48963
      
    }
    
  }
  
  if (parameter == "rv") {
    
    if (sex == 1) {
      
      nu <- 0.5931
      
    } else {
      
      nu <- 0.4197
      
    }
    
  }
  
  if (parameter == "tlc") {
    
    if (sex == 1) {
      
      nu <- 0.9337
      
    } else {
      
      nu <- 0.4636
      
    }
    
  }
  
  if (parameter == "va") {
    
    if (sex == 1) {
      
      nu <- 0.62559
      
    } else {
      
      nu <- 0.51919
      
    }
    
  }
  
  return (nu)
  
}

get_nu_2012 <- function (age, height, sex, race, parameter) {
  
  if (parameter == "fev1") {
    
    if (sex == 1) {
      
      nu <- 0.886600 + 0.085000 * log (age)
    
    } else {
      
      nu <- 1.1540
      
    }
    
  }
  
  if (parameter == "fvc") {
    
    if (sex == 1) {
      
      nu <- 0.9481
    
    } else {
      
      nu <- 0.8236
      
    }
    
  }  

  if (parameter == "fev1/fvc") {
    
    if (sex == 1) {
      
      l_spline_lookup_table <- c (
        1.3876, 0.9377, 0.5953, 0.3331, 0.1397, 0.0026, -0.0912, -0.1533,
        -0.1953, -0.224, -0.241, -0.2466, -0.2427, -0.2313, -0.2142, -0.1926,
        -0.1678, -0.1406, -0.1119, -0.0826, -0.0533, -0.0244, 0.0037, 0.0307,
        0.0563, 0.0802, 0.1022, 0.1222, 0.14, 0.1557, 0.169, 0.1801, 0.1889,
        0.1955, 0.2, 0.2025, 0.2031, 0.2021, 0.1995, 0.1955, 0.1904, 0.1843,
        0.1773, 0.1696, 0.1613, 0.1524, 0.143, 0.1332, 0.123, 0.1125, 0.1016,
        0.0904, 0.0789, 0.0672, 0.0553, 0.0432, 0.031, 0.0187, 0.0064, -0.006,
        -0.0183, -0.0306, -0.0429, -0.0551, -0.0672, -0.0794, -0.0914, -0.1034,
        -0.1153, -0.1271, -0.1387, -0.1503, -0.1618, -0.1732, -0.1845, -0.1956,
        -0.2067, -0.2176, -0.2284, -0.239, -0.2496, -0.26, -0.2703, -0.2805,
        -0.2906, -0.3006, -0.3104, -0.3202, -0.3298, -0.3394, -0.3488, -0.3582,
        -0.3674
      )         
      
      l_spline <- l_spline_lookup_table [age - 2]
      
      nu <- 4.7101 - 0.6774 * log (age) + l_spline
    
    } else {
    
      nu <- 7.032 - 1.197 * log (age)        

    }
    
  }

  return (nu)  
  
}

get_response <- function (fev1, fvc, fev1_post, fvc_post, fev1_predicted, fvc_predicted) {
  
  if (is.na (fev1_post) == 0 & is.na (fvc_post) == 0) {
    
    fev1_change <- (fev1_post - fev1) / fev1_predicted
    
    fvc_change <- (fvc_post - fvc) / fvc_predicted
    
    if (fev1_change > 0.1 | fvc_change > 0.1) {
      
      response <- 1
      
    } else {
      
      response <- 0
      
    }
    
  } else {
    
    response <- NA
    
  }
  
  return (response)
  
}

get_sigma <- function (age, height, sex, parameter) {
  
  if (parameter == "dlco") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.300155958, 0.230836979, 0.172297069, 0.122554596, 0.080056551,
        0.043650547, 0.012482115, -0.014076792, -0.036572357, -0.055508296,
        -0.07132637, -0.084431985, -0.095169923, -0.103850266, -0.110745352,
        -0.116082754, -0.1200547, -0.122824389, -0.124530968, -0.125293735,
        -0.125215539, -0.124385614, -0.122881914, -0.120775919, -0.118133274,
        -0.115011594, -0.111461522, -0.107529076, -0.103261047, -0.098700263,
        -0.093884349, -0.088846439, -0.083615916, -0.078220517, -0.072685948,
        -0.067034954, -0.061287663, -0.055461912, -0.049573515, -0.04363617,
        -0.037661666, -0.031660482, -0.025641953, -0.019614403, -0.013585252,
        -0.00756112, -0.001548143, 0.00444773, 0.010421141, 0.01636732,
        0.022282025, 0.028161487, 0.034002365, 0.039801699, 0.045556886,
        0.051265726, 0.056926328, 0.062537039, 0.068096425, 0.073603246,
        0.079056439, 0.084455101, 0.089798473, 0.095085925, 0.100316992,
        0.105491489, 0.110609352, 0.115670587, 0.120675257, 0.125623481,
        0.130515425, 0.135351299, 0.140131351, 0.144855865, 0.149525155,
        0.154139583, 0.158699905, 0.163207187, 0.167662473, 0.172066779,
        0.176421095, 0.180726479, 0.18498384, 0.189193955, 0.193357588
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-1.98996 + 0.03536 * log (age) + s_spline)      
      
    } else {
      
      s_spline_lookup_table <- c (
        0.249241921, 0.194538485, 0.148745934, 0.109894592, 0.076513277,
        0.047581626, 0.022395655, 0.000482949, -0.018555896, -0.035082951,
        -0.049406479, -0.061791656, -0.072462639, -0.081607487, -0.089386285,
        -0.095937096, -0.101378434, -0.105813576, -0.109333085, -0.112010698,
        -0.113907442, -0.115078795, -0.115575263, -0.115441296, -0.114716795,
        -0.113438642, -0.111640978, -0.109357243, -0.106622438, -0.103469047,
        -0.09992669, -0.096022434, -0.09178164, -0.087230371, -0.08239321,
        -0.077292529, -0.071948723, -0.066380423, -0.060605145, -0.054642247,
        -0.048510765, -0.042227971, -0.035809556, -0.029269788, -0.022621661,
        -0.01587733, -0.009051355, -0.002159106, 0.004785483, 0.0117698,
        0.018782428, 0.025813028, 0.032852237, 0.039891565, 0.046922901,
        0.053938313, 0.060930575, 0.067893153, 0.074820136, 0.081706186,
        0.088546483, 0.095336683, 0.102072871, 0.108751596, 0.115370487,
        0.121927884, 0.128422331, 0.13485256, 0.141217469, 0.147516109,
        0.153747675, 0.159911484, 0.166006976, 0.172033695, 0.177991297,
        0.183880137, 0.189701371, 0.195456183, 0.20114573, 0.206771142,
        0.212333522, 0.217833956, 0.223273494, 0.228653159, 0.233973973
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-1.82905 - 0.01815 * log (age) + s_spline)            
      
    }
    
  }
  
  if (parameter == "fev1") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.072337153, 0.049397165, 0.030805517, 0.015607502, 0.003078378,
        -0.00735457, -0.01612753, -0.023555217, -0.029871683, -0.035233793,
        -0.039754188, -0.043523323, -0.046599967, -0.049034207, -0.05087416,
        -0.052170268, -0.052970381, -0.053317212, -0.053251042, -0.052816226,
        -0.052053473, -0.050998097, -0.049680914, -0.048130148, -0.046372107,
        -0.044429906, -0.04232383, -0.040071737, -0.037689471, -0.035191432,
        -0.032590514, -0.029898173, -0.027124612, -0.02427894, -0.021369316,
        -0.018403848, -0.015391107, -0.01233885, -0.009253983, -0.006142663,
        -0.003010387, 0.000137935, 0.003297898, 0.006464856, 0.009633744,
        0.012799988, 0.015959512, 0.019108692, 0.022244298, 0.02536346,
        0.02846363, 0.031542545, 0.034598212, 0.037628925, 0.040633199,
        0.043609727, 0.046557367, 0.049475123, 0.052362129, 0.05521764,
        0.05804102, 0.060831727, 0.063589309, 0.066313411, 0.069004114,
        0.071661853, 0.074287076, 0.076880233, 0.079441771, 0.081972135,
        0.08447177, 0.086941116, 0.089380608, 0.091790681, 0.094171762,
        0.096524275, 0.098848639, 0.101145296, 0.103414826, 0.105657843,
        0.107874938, 0.110066682, 0.11223363, 0.114376316, 0.116495259,
        0.118590961, 0.120663908, 0.122714586, 0.124743431, 0.126750856
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.256278 + 0.080729 * log (age) + s_spline)
      
    } else {
      
      s_spline_lookup_table <- c (
        0.105023469, 0.066955942, 0.039364403, 0.019945763, 0.006619247, 
        -0.002596684, -0.009152836, -0.014111829, -0.018161267, -0.02171957,
        -0.025063881, -0.028344845, -0.031637911, -0.034992853, -0.038398682, 
        -0.041798173 ,-0.045146233, -0.048405921, -0.051512011, -0.054392748, 
        -0.056994145, -0.059276379, -0.061207648, -0.062757208, -0.063901867, 
        -0.064625772, -0.064918883, -0.064776551, -0.064207446, -0.063227952,
        -0.061854231, -0.060101998, -0.057986465, -0.05552232, -0.052727422, 
        -0.049631436, -0.046263962, -0.042651664, -0.038818604, -0.034786534, 
        -0.030575146, -0.026202299, -0.02168616, -0.017048938, -0.012311671,
        -0.007493286, -0.002610817, 0.002320395, 0.007286528, 0.012275129,
        0.017274972, 0.022275989, 0.027270092, 0.032250877, 0.037212604, 
        0.042150101, 0.047058712, 0.051934248, 0.056772944, 0.061571423,
        0.066326654, 0.07103593, 0.07569683, 0.080307548, 0.084867772,
        0.089377572, 0.093837067, 0.098246421, 0.102605840, 0.106915564, 
        0.111175867, 0.11538705, 0.119549439, 0.123663383, 0.127729251,
        0.131747427, 0.135718311, 0.139642476, 0.143520879, 0.147354507, 
        0.151144316, 0.154891231, 0.158596149, 0.162259939, 0.165883443, 
        0.169467478, 0.173012837, 0.176520288, 0.179990577, 0.18342443
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.364047 + 0.129402 * log (age) + s_spline)
      
    }        
    
  }
  
  if (parameter == "fvc") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.057281204, 0.038624578, 0.023607021, 0.011424295, 0.001471157,
        -0.006723165, -0.013517123, -0.019178381, -0.023909971, -0.027865889,
        -0.031165881, -0.033901236, -0.036128414, -0.037892547, -0.039233567,
        -0.040183109, -0.040768573, -0.041015495, -0.04094946, -0.040601584,
        -0.040001133, -0.03917367, -0.038141656, -0.036926358, -0.035548354,
        -0.034025774, -0.032374526, -0.030608619, -0.028740637, -0.026782855,
        -0.024746482, -0.022641419, -0.020476429, -0.018259282, -0.015996891,
        -0.013695933, -0.011363211, -0.009004838, -0.006626239, -0.004232229,
        -0.00182709, 0.000585371, 0.003001762, 0.005418772, 0.007833085,
        0.010241727, 0.012642058, 0.015031736, 0.017408682, 0.019771057,
        0.022117233, 0.024445772, 0.02675542, 0.029045133, 0.031314018, 
        0.033561296, 0.035786295, 0.037988433, 0.040167216, 0.042322224, 
        0.044453106, 0.046559571, 0.048641387, 0.05069838, 0.05273063,
        0.054738424, 0.05672206, 0.058681838, 0.060618061, 0.062531032, 
        0.064421054, 0.066288432, 0.068133468, 0.069956463, 0.071757718,
        0.07353753, 0.075296195, 0.077034028, 0.078751454, 0.080448924,
        0.082126875, 0.083785727, 0.085425888, 0.087047756, 0.088651712,
        0.090238127, 0.091807362, 0.093359781, 0.0948957, 0.096415417
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.195595 + 0.068466 * log (age) + s_spline)
      
    } else {
      
      s_spline_lookup_table <- c (
        0.091010919, 0.05893963, 0.036122984, 0.020503561, 0.010163041,
        0.003261599, -0.001542841, -0.00523079, -0.008435044, -0.011550642,
        -0.014829047, -0.018365664, -0.022169975, -0.026239075, -0.030504927,
        -0.034849674, -0.039181104, -0.043426446, -0.047495, -0.051296751,
        -0.0547639, -0.057846269, -0.060506549, -0.062715991, -0.064454526,
        -0.065709309, -0.066473193, -0.066744244, -0.066533134, -0.065857825,
        -0.064736088, -0.063185257, -0.061222168, -0.058863112, -0.056128272,
        -0.053052068, -0.049668916, -0.046009776, -0.042102551, -0.037972429,
        -0.033642183, -0.029132437, -0.024464041, -0.0196622, -0.014750744,
        -0.009751093, -0.004682517, 0.000437644, 0.005593781, 0.010771837,
        0.015959154, 0.021144425, 0.026319268, 0.031477755, 0.036614607,
        0.041725073, 0.04680488, 0.051850189, 0.056857557, 0.061823895, 
        0.066746443, 0.071622733, 0.076450568, 0.08122829, 0.085955514, 
        0.090632196, 0.095258352, 0.099834049, 0.104359404, 0.108834577,
        0.113259766, 0.117635204, 0.121961154, 0.126237907, 0.130465777,
        0.1346451, 0.138776234, 0.142859703, 0.146896415, 0.150887308,
        0.154833293, 0.158735256, 0.162594055, 0.166410525, 0.170185478,
        0.173919703, 0.177613968, 0.181269017, 0.184885577, 0.188464355
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.310148 + 0.120428 * log (age) + s_spline)
      
    }
    
  }
  
  if (parameter == "fev1/fvc") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.04501273, 0.044271869, 0.041741105, 0.036751685, 0.030798272, 
        0.026562318, 0.024563815, 0.024204644, 0.024432178, 0.0244019,
        0.023533943, 0.021612804, 0.018671858, 0.014840877, 0.010335984,
        0.005396413, 0.000227949, -0.005004279, -0.010165307, -0.01514917,
        -0.019858591, -0.024189964, -0.028050214, -0.031361205, -0.034067995,
        -0.036131842, -0.037538767, -0.038290925, -0.038399416, -0.037872532,
        -0.036716206, -0.034939952, -0.032560508, -0.029599422, -0.026080176,
        -0.022028226, -0.017468703, -0.01242601, -0.006929132, -0.001009467,
        0.005300503, 0.011965483, 0.01894945, 0.026220461, 0.033753141,
        0.041522129, 0.0495015, 0.057665355, 0.065988728, 0.074447997,
        0.083021379, 0.091689499, 0.100433447, 0.109233818, 0.11807297,
        0.126935006, 0.135804097, 0.144665683, 0.153505505, 0.162310495, 
        0.171069048, 0.179771615, 0.188410433, 0.196979232, 0.205472949,
        0.213887511, 0.22222013, 0.230468683, 0.238631437, 0.246707212, 
        0.254695343, 0.262595384, 0.270406884, 0.278129776, 0.285764342, 
        0.29331088, 0.300770291, 0.308143798, 0.315432574, 0.322637725, 
        0.329760361, 0.336801784, 0.343763346, 0.35064663, 0.357453286
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.882025 + 0.068889 * log (age) + s_spline)
      
    } else {
      
      s_spline_lookup_table <- c (
        0.051845823, 0.043555518, 0.03604702, 0.028926881, 0.022262836, 
        0.016386321, 0.011249676, 0.00668324, 0.00254365, -0.00124848,
        -0.004746278, -0.007968582, -0.010921835, -0.013622212, -0.016093567,
        -0.018351395, -0.020407135, -0.022265797, -0.023925738, -0.025387753,
        -0.026649986, -0.02770541, -0.028543983, -0.02915278, -0.029520715,
        -0.029641288, -0.029507811, -0.029114184, -0.028453694, -0.027520198,
        -0.026307581, -0.024811479, -0.02302989, -0.020962052, -0.018608539,
        -0.015972615, -0.013059946, -0.009879752, -0.006443637, -0.002764011,
        0.00114632, 0.005272321, 0.009597827, 0.014107461, 0.018786028,
        0.023618005, 0.028587701, 0.033679874, 0.038879969, 0.044174387,
        0.04955013, 0.054994794, 0.060496516, 0.066043998, 0.071626168,
        0.077232297, 0.082852388, 0.088477845, 0.09410105, 0.099715411,
        0.105314674, 0.110892819, 0.116444212, 0.121963649, 0.127446089,
        0.132886752, 0.138281271, 0.143625983, 0.148918067, 0.154155521,
        0.159336978, 0.164461469, 0.169528598, 0.174538172, 0.179490209,
        0.184384927, 0.189222825, 0.194004593, 0.198731045, 0.203403085,
        0.208021636, 0.21258768, 0.217102204, 0.221566172, 0.22598057
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-3.171582 + 0.144358 * log (age) + s_spline)
      
    }
    
  }
  
  if (parameter == "kco") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.319367031, 0.253413376, 0.196051342, 0.145271207, 0.099323319,
        0.057482206, 0.019731114, -0.013436324, -0.041877439, -0.065883209,
        -0.085850074, -0.102298256, -0.115686281, -0.12638221, -0.134688509,
        -0.140867955, -0.145176851, -0.147847132, -0.149076601, -0.149059544,
        -0.14799077, -0.146035812, -0.143334438, -0.140007457, -0.136159766,
        -0.131880781, -0.127246877, -0.122319941, -0.117137263, -0.111727034,
        -0.106114266, -0.100321212, -0.094367607, -0.088269701, -0.082041163,
        -0.075694347, -0.069240457, -0.062689672, -0.056051404, -0.049338686,
        -0.042568299, -0.035755467, -0.028913747, -0.022055221, -0.015190656,
        -0.008329649, -0.001481155, 0.00534603, 0.012143972, 0.018905612,
        0.025624676, 0.032295595, 0.038913429, 0.045473807, 0.051973245,
        0.058411365, 0.064789075, 0.071107287, 0.077366906, 0.083568828,
        0.089713943, 0.095803128, 0.101837252, 0.10781717, 0.113743454,
        0.119615584, 0.125432866, 0.131194719, 0.136900663, 0.142550317,
        0.148143381, 0.153679636, 0.159158931, 0.164581181, 0.16994636,
        0.175254508, 0.180505975, 0.185701359, 0.190841267, 0.195926313,
        0.200957113, 0.205934671, 0.210859498, 0.215731708, 0.220551445
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-1.98186 + 0.01460 * log (age) + s_spline)      
      
    } else {
      
      s_spline_lookup_table <- c (
        0.189680385, 0.152408924, 0.120127187, 0.091634597, 0.066158261,
        0.043259763, 0.022695315, 0.004352333, -0.011915034, -0.026297873,
        -0.038975975, -0.050113776, -0.059855015, -0.068306338, -0.075555844,
        -0.081687478, -0.086783969, -0.09092272, -0.094174591, -0.096607489,
        -0.098285592, -0.099266864, -0.09960395, -0.099347179, -0.098543507,
        -0.097235259, -0.095460687, -0.093256143, -0.090658408, -0.087701069,
        -0.084414335, -0.080825453, -0.076959781, -0.0728438, -0.068502396,
        -0.063957929, -0.059230536, -0.054338383, -0.049298331, -0.044128834,
        -0.038847874, -0.033471613, -0.028014579, -0.022489849, -0.016909203,
        -0.011283404, -0.005623758, 5.86e-05, 0.005753469, 0.011451924,
        0.017145776, 0.022827698, 0.028491101, 0.03413007, 0.03973944,
        0.045314789, 0.050852168, 0.056348046, 0.061799266, 0.067203012,
        0.072556779, 0.077858342, 0.083105732, 0.088297286, 0.093432329,
        0.098510784, 0.10353265, 0.108497989, 0.113406918, 0.118259604,
        0.123056258, 0.127797131, 0.13248251, 0.137112713, 0.141688093,
        0.146209331, 0.150677485, 0.155093609, 0.159458729, 0.163773841,
        0.168039911, 0.172257885, 0.176428674, 0.180553165, 0.184632232
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-1.63787 - 0.07757 * log (age) + s_spline)        
      
    }
    
  }
  
  if (parameter == "rv") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.207284497, 0.202874568, 0.198447361, 0.1939949, 0.189508993,
        0.184980264, 0.180398832, 0.175754817, 0.171038562, 0.166242153,
        0.161358484, 0.156380453, 0.151300953, 0.146112804, 0.140808791,
        0.135381699, 0.129823919, 0.124124069, 0.118268674, 0.112244235,
        0.10603683, 0.099628018, 0.092996619, 0.086121414, 0.07898198,
        0.071567391, 0.063872993, 0.055894244, 0.047628138, 0.039092483,
        0.030320037, 0.021343885, 0.012198506, 0.002939682, -0.006360144,
        -0.015628086, -0.024789388, -0.033736627, -0.042334602, -0.050447227,
        -0.057939078, -0.064688014, -0.070584177, -0.07551817, -0.079382947,
        -0.082126076, -0.083750029, -0.084259689, -0.083660264, -0.081965807,
        -0.079200034, -0.075387155, -0.070550926, -0.064700548, -0.057827926,
        -0.049923954, -0.040979775, -0.030995993, -0.019985452, -0.007961805,
        0.005060969, 0.019053686, 0.033965768, 0.04974503, 0.066339151,
        0.08368792, 0.101719044, 0.120359205, 0.13953512, 0.159176171,
        0.179216188, 0.199589425, 0.220230202, 0.241079512, 0.262090496
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-0.878572 - 0.007032 * age + s_spline)    
      
    } else {
      
      s_spline_lookup_table <- c (
        0.31124378, 0.298973789, 0.28668705, 0.274378421, 0.262046352,
        0.249692955, 0.237320508, 0.224931292, 0.212534109, 0.20015678,
        0.187830583, 0.17558679, 0.163457141, 0.151477843, 0.139687608,
        0.128125177, 0.116829179, 0.105831584, 0.095154002, 0.084817151,
        0.074841747, 0.065246263, 0.056038597, 0.047223528, 0.038805837,
        0.030790595, 0.023188066, 0.016012972, 0.009280182, 0.003004564,
        -0.002798863, -0.008114722, -0.012927581, -0.017222008, -0.020989888,
        -0.024280041, -0.027167968, -0.029729321, -0.03203954, -0.034165536,
        -0.036163058, -0.038087099, -0.039992653, -0.041912733, -0.043795027,
        -0.045566524, -0.047154211, -0.048482551, -0.049441451, -0.049895781,
        -0.04970985, -0.048748199, -0.046907423, -0.044148827, -0.040441505,
        -0.035754553, -0.030065653, -0.023406853, -0.015831414, -0.007392647,
        0.00185606, 0.011859118, 0.022558508, 0.033896085, 0.045813703,
        0.058246892, 0.071110952, 0.084317148, 0.097776746, 0.111402347,
        0.125120976, 0.138868444, 0.152580688, 0.166194015, 0.179673064
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-0.902550 - 0.006005 * age + s_spline)        
      
    }
    
  }
  
  if (parameter == "tlc") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.088394747, 0.082392489, 0.076411414, 0.07045988, 0.06455393,
        0.0587139, 0.052960172, 0.047312491, 0.041782405, 0.036375791,
        0.031098408, 0.025955852, 0.020950808, 0.016083471, 0.011353956,
        0.006762462, 0.002311324, -0.001994877, -0.006151449, -0.010153679,
        -0.013995873, -0.017671069, -0.021172221, -0.024492279, -0.027624013,
        -0.030559899, -0.033292392, -0.035813943, -0.038117153, -0.040194918,
        -0.042040167, -0.043645829, -0.04500399, -0.046104636, -0.046937429,
        -0.047492034, -0.047758571, -0.047728609, -0.047394002, -0.0467466,
        -0.045779801, -0.044493167, -0.042887806, -0.040964825, -0.038725951,
        -0.036176071, -0.033321072, -0.030166843, -0.02671952, -0.022986855,
        -0.018977242, -0.014699081, -0.010160661, -0.005369375, -0.000332163,
        0.004944038, 0.010452182, 0.016184011, 0.022130513, 0.028282667,
        0.034631499, 0.041168795, 0.047886924, 0.054778268, 0.061835126,
        0.069048049, 0.076405924, 0.083897573, 0.091511779, 0.099236131,
        0.107056816, 0.114959945, 0.122931647, 0.130958981, 0.139030355
      )
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (
        -2.0616143 +
          -0.0008534 * age +
          s_spline
      )
      
    } else {
      
      s_spline_lookup_table <- c (
        0.146232484, 0.137270933, 0.128326185, 0.119409995, 0.110542753,
        0.101745355, 0.093038695, 0.084443184, 0.075977267, 0.067658892,
        0.059506007, 0.051536187, 0.043760411, 0.036184003, 0.028812107,
        0.021649863, 0.014702784, 0.007977419, 0.001480491, -0.004781274,
        -0.010801036, -0.016570717, -0.022081474, -0.027324454, -0.032290795,
        -0.036970248, -0.041349864, -0.045416381, -0.049156537, -0.052556785,
        -0.05560155, -0.058274375, -0.060558797, -0.062438422, -0.063899779,
        -0.064933474, -0.065530413, -0.065681504, -0.065379434, -0.064625517,
        -0.063423665, -0.061777793, -0.059691902, -0.057172009, -0.054226143,
        -0.050862423, -0.047088968, -0.042914403, -0.038349042, -0.033403546,
        -0.028088575, -0.022415029, -0.016397049, -0.010051102, -0.003393707,
        0.003558609, 0.010787196, 0.018268524, 0.025978379, 0.033892544,
        0.041987161, 0.050241432, 0.058636127, 0.06715203, 0.075769948,
        0.084472213, 0.093243644, 0.102069289, 0.110934195, 0.119824077,
        0.128728506, 0.137638443, 0.146544845, 0.155438825, 0.164316207
      )      
      
      s_spline <- s_spline_lookup_table [age - 5]      
      
      sigma <- exp (
        -2.0999321 +
          0.0001564 * age +
          s_spline
      )      
      
    }
    
  }
  
  if (parameter == "va") {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.133648233, 0.099200204, 0.070610588, 0.046884305, 0.027196087,
        0.010939224, -0.002358721, -0.01312839, -0.021759351, -0.02862165,
        -0.034016276, -0.038193209, -0.04135337, -0.043663093, -0.045260011,
        -0.046256574, -0.046748651, -0.046816854, -0.04652793, -0.045939143,
        -0.045100348, -0.044053402, -0.042833463, -0.041469371, -0.039984808,
        -0.038399951, -0.036732075, -0.034995917, -0.033203731, -0.031365981,
        -0.029491735, -0.027588861, -0.025664241, -0.023724399, -0.021775373,
        -0.019822419, -0.0178701, -0.015922387, -0.013982698, -0.012053182,
        -0.010134766, -0.008228194, -0.0063341, -0.004453021, -0.002585412,
        -0.00073165, 0.001108129, 0.002934195, 0.004746855, 0.006546403,
        0.008333122, 0.010107282, 0.011869143, 0.013618957, 0.015356827,
        0.017081878, 0.018792909, 0.020488844, 0.022168728, 0.023831712,
        0.025477047, 0.02710407, 0.028712197, 0.030300921, 0.031869907,
        0.033419307, 0.034949391, 0.036460433, 0.037952701, 0.039426465,
        0.040881991, 0.042319546, 0.043739391, 0.045141788, 0.046526992,
        0.047895264, 0.049246933, 0.050582386, 0.051901999, 0.053206133,
        0.054495138, 0.055769366, 0.057029142, 0.058274762, 0.059506516
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.20953 + 0.01937 * log (age) + s_spline)      
      
    } else {
      
      s_spline_lookup_table <- c (
        0.201218452, 0.157504114, 0.121382836, 0.090217206, 0.06250464,
        0.037613019, 0.015381133, -0.00401029, -0.020541325, -0.034380577,
        -0.045785587, -0.055130782, -0.062738025, -0.068872841, -0.073754229,
        -0.077566539, -0.080486759, -0.082668215, -0.084236369, -0.085288446,
        -0.085900365, -0.086135997, -0.086047525, -0.085659001, -0.084980216,
        -0.084021167, -0.082792023, -0.081298093, -0.079534213, -0.077496127,
        -0.075181835, -0.07259115, -0.06972636, -0.066595743, -0.063209131,
        -0.0595761, -0.055705943, -0.051607659, -0.047291494, -0.042778297,
        -0.038091807, -0.033253426, -0.028282456, -0.023196323, -0.018010778,
        -0.012740181, -0.007398774, -0.002000217, 0.003443131, 0.008920097,
        0.014420571, 0.019935407, 0.025456329, 0.030975843, 0.036487016,
        0.04198336, 0.047458993, 0.052908597, 0.058327371, 0.063710976,
        0.069055505, 0.074357434, 0.079613596, 0.084821227, 0.089978728,
        0.095085224, 0.100139976, 0.10514236, 0.110091856, 0.11498804,
        0.119830574, 0.124619202, 0.129353735, 0.134034055, 0.138660109,
        0.143232306, 0.147751587, 0.152218906, 0.156635192, 0.161001355,
        0.16531828, 0.169586834, 0.173807861, 0.17798218, 0.182110604
      )    
      
      s_spline <- s_spline_lookup_table [age - 5]
      
      sigma <- exp (-2.08839 - 0.01334 * log (age) + s_spline)        
      
    }
    
  }  
  
  return (sigma)
  
}

get_sigma_2012 <- function (age, height, sex, race, parameter) {
  
  if (parameter == 'fev1') {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.2143, 0.1794, 0.1535, 0.1285, 0.0912, 0.0439, -0.0092, -0.0461, -0.0525,
        -0.0387, -0.0199, -0.0091, -0.0108, -0.0234, -0.0421, -0.0614, -0.0781,
        -0.0901, -0.0965, -0.098, -0.0956, -0.0905, -0.0844, -0.0783, -0.0729,
        -0.0686, -0.0652, -0.0625, -0.0603, -0.0585, -0.0572, -0.0566, -0.0568,
        -0.0575, -0.0584, -0.0591, -0.0596, -0.0596, -0.0593, -0.0585, -0.057,
        -0.0548, -0.0517, -0.0478, -0.0431, -0.0374, -0.0311, -0.024, -0.0164,
        -0.0082, 3e-04, 0.0092, 0.0183, 0.0276, 0.0372, 0.0469, 0.0569, 0.0671,
        0.0774, 0.0879, 0.0985, 0.1091, 0.1196, 0.1301, 0.1404, 0.1504, 0.1603,
        0.1698, 0.1792, 0.1882, 0.1971, 0.2057, 0.2141, 0.2223, 0.2304, 0.2383,
        0.2461, 0.2538, 0.2614, 0.2689, 0.2763, 0.2836, 0.2909, 0.298, 0.3051,
        0.3122, 0.3191, 0.326, 0.3327, 0.3395, 0.3461, 0.3527, 0.3592
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- 0.0114
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.1096
      #if (race == 3) race_correction <- -0.3973
      #if (race == 4) race_correction <- 0.0327
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- 0.0114

      sigma <- exp (-2.326 + 0.0798 * log (age) + race_correction + s_spline)
      
      
    } else {
      
      s_spline_lookup_table <- c (
        0.3351, 0.2439, 0.1749, 0.1208, 0.078, 0.0452, 0.0206, 0.0037, -0.0076,
        -0.016, -0.0233, -0.0305, -0.0373, -0.0437, -0.0495, -0.0546, -0.059,
        -0.0627, -0.066, -0.0691, -0.0722, -0.0751, -0.078, -0.0808, -0.0836,
        -0.0862, -0.0887, -0.0909, -0.0929, -0.0945, -0.0957, -0.0964, -0.0967,
        -0.0964, -0.0955, -0.094, -0.0919, -0.0892, -0.0859, -0.0821, -0.0777,
        -0.0728, -0.0674, -0.0616, -0.0554, -0.0488, -0.0418, -0.0345, -0.027,
        -0.0192, -0.0112, -0.003, 0.0054, 0.0139, 0.0226, 0.0314, 0.0402,
        0.0492, 0.0581, 0.0671, 0.0761, 0.0852, 0.0942, 0.1032, 0.1122, 0.1212,
        0.1301, 0.1389, 0.1477, 0.1564, 0.1651, 0.1736, 0.1821, 0.1905, 0.1988,
        0.207, 0.2151, 0.2231, 0.231, 0.2389, 0.2466, 0.2543, 0.2618, 0.2693,
        0.2767, 0.2841, 0.2913, 0.2985, 0.3056, 0.3126, 0.3195, 0.3264, 0.3332
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- 0.0114
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.1016
      #if (race == 3) race_correction <- -0.0109
      #if (race == 4) race_correction <- 0.0733
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- 0.0114

      sigma <- exp (-2.3765 + 0.0972 * log (age) + race_correction + s_spline)      
      
    }
    
  }
  
  if (parameter == 'fvc') {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        0.2986, 0.2263, 0.1691, 0.1202, 0.0766, 0.0381, 0.0048, -0.0211, -0.0383,
        -0.0484, -0.0542, -0.058, -0.0611, -0.0641, -0.0673, -0.0706, -0.0738,
        -0.0767, -0.079, -0.0807, -0.0818, -0.0823, -0.0822, -0.0817, -0.0809,
        -0.0799, -0.0786, -0.0771, -0.0754, -0.0735, -0.0714, -0.069, -0.0665,
        -0.0637, -0.0607, -0.0574, -0.0539, -0.0501, -0.0461, -0.0417, -0.0371,
        -0.0322, -0.027, -0.0216, -0.0159, -0.01, -0.0039, 0.0025, 0.009, 0.0156,
        0.0224, 0.0293, 0.0363, 0.0434, 0.0505, 0.0577, 0.0649, 0.0722, 0.0796,
        0.0869, 0.0943, 0.1017, 0.1091, 0.1164, 0.1238, 0.1311, 0.1384, 0.1456,
        0.1527, 0.1598, 0.1669, 0.1738, 0.1807, 0.1875, 0.1943, 0.201, 0.2076,
        0.2141, 0.2205, 0.2269, 0.2332, 0.2394, 0.2455, 0.2516, 0.2576, 0.2636,
        0.2694, 0.2752, 0.281, 0.2866, 0.2922, 0.2978, 0.3033
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- -0.0503
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.0794
      #if (race == 3) race_correction <- -0.4600
      #if (race == 4) race_correction <- 0.0325
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0503

      sigma <- exp (-2.2963 + 0.0718 * log (age) + race_correction + s_spline)
      
    } else {
      
      s_spline_lookup_table <- c (
        0.3694, 0.2744, 0.1995, 0.1355, 0.0815, 0.0396, 0.0074, -0.0137, -0.0246,
        -0.0289, -0.0304, -0.031, -0.0316, -0.0326, -0.0339, -0.0354, -0.0371,
        -0.0391, -0.0414, -0.0442, -0.0474, -0.0511, -0.055, -0.0592, -0.0635,
        -0.068, -0.0723, -0.0767, -0.0808, -0.0847, -0.0883, -0.0915, -0.0942,
        -0.0962, -0.0976, -0.0981, -0.0977, -0.0965, -0.0945, -0.0916, -0.088,
        -0.0837, -0.0787, -0.0731, -0.0669, -0.0602, -0.0529, -0.0453, -0.0373,
        -0.0289, -0.0202, -0.0113, -0.0022, 0.0071, 0.0165, 0.026, 0.0356,
        0.0453, 0.055, 0.0647, 0.0744, 0.0841, 0.0938, 0.1034, 0.1131, 0.1228,
        0.1325, 0.1421, 0.1517, 0.1612, 0.1707, 0.1801, 0.1895, 0.1987, 0.2079,
        0.217, 0.226, 0.235, 0.2438, 0.2526, 0.2613, 0.2699, 0.2784, 0.2868,
        0.2952, 0.3034, 0.3116, 0.3196, 0.3276, 0.3355, 0.3433, 0.351, 0.3586
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- -0.0503
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- 0.0810
      #if (race == 3) race_correction <- -0.1809
      #if (race == 4) race_correction <- 0.0459
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0503

      sigma <- exp (-2.3549 + 0.1017 * log (age) + race_correction + s_spline)      
      
    }
    
  }
  
  if (parameter == 'fev1/fvc') {
    
    if (sex == 1) {
      
      s_spline_lookup_table <- c (
        -0.0832, -0.0085, 0.0287, 0.035, 0.0327, 0.0298, 0.0159, -0.0058,
        -0.0204, -0.0238, -0.0177, -0.0068, 0.0054, 0.0159, 0.0233, 0.0275,
        0.0284, 0.0265, 0.0226, 0.0171, 0.0102, 0.002, -0.0073, -0.0175,
        -0.0282, -0.0388, -0.0489, -0.0583, -0.0669, -0.0745, -0.0813, -0.0872,
        -0.0922, -0.0963, -0.0995, -0.1016, -0.1027, -0.1029, -0.102, -0.1003,
        -0.0976, -0.0939, -0.0894, -0.084, -0.0779, -0.0712, -0.0639, -0.0561,
        -0.0477, -0.0388, -0.0294, -0.0197, -0.0095, 0.001, 0.0118, 0.0229,
        0.0343, 0.046, 0.0578, 0.0698, 0.082, 0.0942, 0.1064, 0.1187, 0.1308,
        0.1429, 0.1549, 0.1668, 0.1786, 0.1903, 0.2018, 0.2132, 0.2245, 0.2357,
        0.2468, 0.2577, 0.2686, 0.2793, 0.2899, 0.3004, 0.3107, 0.321, 0.3311,
        0.3411, 0.3511, 0.3609, 0.3706, 0.3801, 0.3896, 0.399, 0.4083, 0.4174,
        0.4265
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- -0.0860
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.0381
      #if (race == 3) race_correction <- -0.2227
      #if (race == 4) race_correction <- -0.1414
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0860

      sigma <- exp (-2.9595 + 0.1156 * log (age) + race_correction + s_spline)
      
      
    } else {
      
      s_spline_lookup_table <- c (
        0.0305, 0.048, 0.0534, 0.0473, 0.0376, 0.0289, 0.0175, 0.0045, -0.0055,
        -0.0121, -0.0163, -0.019, -0.0203, -0.0204, -0.0196, -0.0179, -0.0156,
        -0.0131, -0.0108, -0.009, -0.0078, -0.0073, -0.0077, -0.009, -0.011,
        -0.0136, -0.0168, -0.0205, -0.0244, -0.0286, -0.033, -0.0374, -0.042,
        -0.0464, -0.0506, -0.0546, -0.0583, -0.0614, -0.064, -0.0659, -0.0672,
        -0.0677, -0.0676, -0.0667, -0.0651, -0.0628, -0.0598, -0.0561, -0.0519,
        -0.0471, -0.0417, -0.0359, -0.0296, -0.0228, -0.0157, -0.0082, -3e-04,
        0.0078, 0.0162, 0.0248, 0.0335, 0.0425, 0.0516, 0.0608, 0.0702, 0.0796,
        0.0891, 0.0987, 0.1083, 0.1178, 0.1274, 0.1369, 0.1463, 0.1556, 0.1649,
        0.1741, 0.1832, 0.1923, 0.2012, 0.21, 0.2188, 0.2274, 0.236, 0.2445,
        0.2529, 0.2611, 0.2693, 0.2775, 0.2855, 0.2934, 0.3013, 0.309, 0.3167
      )
      
      s_spline <- s_spline_lookup_table [age - 2]
      
      race_correction <- -0.0860
      
      if (is.na (race) == 0 && race == 1) race_correction <- 0
      if (is.na (race) == 0 && race == 2) race_correction <- -0.0307
      #if (race == 3) race_correction <- -0.1640
      #if (race == 4) race_correction <- -0.1521
      #if (race == 3 | race == 4 | race == 5 | is.na (race)) race_correction <- -0.0860

      sigma <- exp (-3.2395 + 0.1850 * log (age) + race_correction + s_spline)      
      
    }
    
  }
  
  return (sigma)
  
}

get_z_score <- function (age, height, sex, parameter, data) {
  
  mu <- get_mu (age, height, sex, parameter)
  sigma <- get_sigma (age, height, sex, parameter)
  nu <- get_nu (age, height, sex, parameter)
  
  z_score <- ((data / mu)^nu - 1) / (nu * sigma)
  
  return (z_score)
  
}

get_z_score_2012 <- function (age, height, sex, race, parameter, data) {
  
  mu <- get_mu_2012 (age, height, sex, race, parameter)
  sigma <- get_sigma_2012 (age, height, sex, race, parameter)
  nu <- get_nu_2012 (age, height, sex, race, parameter)
  
  z_score <- ((data / mu)^nu - 1) / (nu * sigma)
  
  return (z_score)
  
}

print_ci <- function (ci) {
  
  output <- paste (
    "(",
    ci$conf.int [[1]] %>%
      multiply_by (100) %>%
      round (digits = 1) %>% 
      format (nsmall = 1),
    ", ",
    ci$conf.int [[2]] %>%
      multiply_by (100) %>%
      round (digits = 1) %>% 
      format (nsmall = 1),
    ")",
    sep = ""
  )

  return (output)
  
}

print_annotation <- function (model, adjusted) {
  
  if (adjusted == 0) {
    
    hr <- exp (model$coefficients[[1]])

    hr_lower <- exp (confint (model)[[1]])
    hr_upper <- exp (confint (model)[[2]])
    
    p_value <- summary (model)$coefficients[[1, 5]]
    
  } else {
    
    hr <- exp (model$coefficients[[6]])
    
    hr_lower <- exp (confint (model)[[6, 1]])
    hr_upper <- exp (confint (model)[[6, 2]])
    
    p_value <- summary (model)$coefficients[[6, 5]]
    
  }
  
  hr <- print_value (hr)
  hr_lower <- print_value (hr_lower)
  hr_upper <- print_value (hr_upper)
  p_value <- print_p_value (p_value)
  
  annotation <- paste (
    "Hazard Ratio = ",
    hr,
    " (95% CI ",
    hr_lower,
    "\u2013",
    hr_upper,
    sep = ""
  )
  
  if (p_value == "< 0.001") {
    
    annotation <- paste (annotation, ", P Value < 0.001)", sep = "")
    
  } else {
    
    annotation <- paste (annotation, ", P Value = ", p_value, ")", sep = "")
    
  }
  
  return (annotation)
  
}

print_p_value <- function (p_value) {
  
  if (p_value < 0.001) {
    
    output <- "< 0.001"
    
  } else {
    
    output <- p_value %>% 
      round (digits = 3) %>% 
      format (nsmall = 3)
    
  }
  
  return (output)
  
}

print_value <- function (value) {
  
  output <- value %>% 
    round (digits = 2) %>% 
    format (nsmall = 2)
  
  return (output)
  
}

render_categorical <- function(x, ...) {
  
  c ("", sapply(levels(x), function(y) {
    n <- sum (x == y, na.rm = TRUE)
    N <- sum (!is.na(x))
    sprintf ("%s (%.1f%%)", format (n, big.mark = ","), 100 * n / N)
  }))
  
}

render_continuous <- function(x, ...) {
   
  x_clean <- x[!is.na(x)]
  mean_val <- mean (x_clean, na.rm = TRUE)
  sd_val <- sd (x_clean, na.rm = TRUE)
  mean_formatted <- sprintf ("%.1f", mean_val)
  sd_formatted <- sprintf ("%.1f", sd_val)
  paste0(mean_formatted, " (", sd_formatted, ")")

}  